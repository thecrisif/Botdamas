<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>DAMAS ‚Äî THE CRIS IF</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Crimson+Pro:ital,wght@0,400;0,600;1,400&display=swap');

:root {
  --gold: #c9a84c;
  --gold2: #f0d080;
  --gold3: #8b6914;
  --dark: #0d0a06;
  --dark2: #1a1408;
  --dark3: #241c0a;
  --dark4: #2e2410;
  --light-sq: #f0f0f0;
  --dark-sq: #1a1a1a;
  --red-piece: #111111;
  --red-piece2: #2a2a2a;
  --red-piece3: #444444;
  --white-piece: #f0e6cc;
  --white-piece2: #fff8f0;
  --board-border: #8b6914;
  --glow-gold: 0 0 20px rgba(201,168,76,0.6);
}

* { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; touch-action:manipulation; }

body {
  background: var(--dark);
  font-family: 'Crimson Pro', serif;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  overflow-x: hidden;
  color: var(--gold2);
}

body::before {
  content:'';
  position:fixed; inset:0;
  background:
    radial-gradient(ellipse at 50% 0%, rgba(201,168,76,0.08) 0%, transparent 60%),
    radial-gradient(ellipse at 50% 100%, rgba(139,105,20,0.06) 0%, transparent 60%);
  pointer-events:none;
}

/* PANTALLA MEN√ö */
#screen-menu {
  display:flex; flex-direction:column; align-items:center;
  justify-content:center; min-height:100vh;
  padding:30px 20px; gap:0;
}

.logo-wrap { text-align:center; margin-bottom:36px; }

.logo-title {
  font-family:'Cinzel', serif;
  font-size: clamp(2.8rem,12vw,5rem);
  font-weight:900;
  color: var(--gold);
  text-shadow: 0 0 40px rgba(201,168,76,0.5), 0 2px 4px rgba(0,0,0,0.8);
  letter-spacing:0.15em;
  line-height:1;
}

.logo-sub {
  font-family:'Cinzel', serif;
  font-size:clamp(0.6rem,2.5vw,0.85rem);
  letter-spacing:0.5em;
  color:rgba(201,168,76,0.4);
  margin-top:6px;
}

.logo-crown { font-size:clamp(2rem,8vw,3.5rem); margin-bottom:8px; display:block; }

.divider {
  width:200px; height:1px;
  background:linear-gradient(90deg,transparent,var(--gold),transparent);
  margin:20px auto;
}

.menu-label {
  font-family:'Cinzel', serif;
  font-size:0.65rem;
  letter-spacing:0.4em;
  color:rgba(201,168,76,0.4);
  margin-bottom:16px;
  text-align:center;
}

.difficulty-cards {
  display:flex; flex-direction:column; gap:12px;
  width:100%; max-width:300px;
}

.diff-card {
  padding:18px 24px;
  border-radius:4px;
  border:1px solid;
  background:rgba(0,0,0,0.4);
  cursor:pointer;
  transition:all 0.3s;
  text-align:left;
  position:relative;
  overflow:hidden;
}

.diff-card::before {
  content:'';
  position:absolute; inset:0;
  opacity:0;
  transition:opacity 0.3s;
}

.diff-card:hover { transform:translateY(-2px); }
.diff-card:hover::before { opacity:1; }
.diff-card:active { transform:scale(0.98); }
.diff-card { font-family:inherit; text-align:left; width:100%; }

.diff-easy { border-color:rgba(46,204,113,0.4); }
.diff-easy:hover { box-shadow:0 0 25px rgba(46,204,113,0.3); border-color:rgba(46,204,113,0.8); }
.diff-easy::before { background:rgba(46,204,113,0.05); }

.diff-normal { border-color:rgba(201,168,76,0.4); }
.diff-normal:hover { box-shadow:var(--glow-gold); border-color:rgba(201,168,76,0.8); }
.diff-normal::before { background:rgba(201,168,76,0.05); }

.diff-hard { border-color:rgba(192,57,43,0.4); }
.diff-hard:hover { box-shadow:0 0 25px rgba(192,57,43,0.4); border-color:rgba(192,57,43,0.8); }
.diff-hard::before { background:rgba(192,57,43,0.05); }

.diff-icon { font-size:1.5rem; margin-bottom:4px; display:block; }
.diff-name {
  font-family:'Cinzel', serif;
  font-size:0.9rem;
  font-weight:700;
  letter-spacing:0.2em;
  margin-bottom:2px;
}
.diff-easy .diff-name { color:#2ecc71; }
.diff-normal .diff-name { color:var(--gold2); }
.diff-hard .diff-name { color:#e74c3c; }
.diff-desc { font-size:0.8rem; color:rgba(255,255,255,0.35); font-style:italic; }

.creator-badge {
  margin-top:30px;
  font-family:'Cinzel', serif;
  font-size:0.5rem;
  letter-spacing:0.4em;
  color:rgba(201,168,76,0.3);
}

/* PANTALLA JUEGO */
#screen-game { display:none; flex-direction:column; align-items:center; padding:16px 12px 30px; min-height:100vh; }

.game-header {
  width:100%; max-width:400px;
  display:flex; align-items:center; justify-content:space-between;
  margin-bottom:14px;
}

.btn-back-game {
  background:none; border:1px solid rgba(201,168,76,0.2);
  color:rgba(201,168,76,0.5); padding:8px 14px; border-radius:4px;
  font-family:'Cinzel', serif; font-size:0.55rem; letter-spacing:0.2em;
  cursor:pointer; transition:all 0.2s;
}
.btn-back-game:hover { border-color:var(--gold); color:var(--gold); }

.diff-badge {
  font-family:'Cinzel', serif;
  font-size:0.55rem; letter-spacing:0.3em;
  padding:6px 14px; border-radius:4px;
}
.badge-easy { border:1px solid rgba(46,204,113,0.4); color:#2ecc71; }
.badge-normal { border:1px solid rgba(201,168,76,0.4); color:var(--gold); }
.badge-hard { border:1px solid rgba(192,57,43,0.4); color:#e74c3c; }

.score-bar {
  width:100%; max-width:400px;
  display:grid; grid-template-columns:1fr auto 1fr;
  align-items:center; gap:10px;
  margin-bottom:14px;
  padding:12px 16px;
  background:rgba(0,0,0,0.3);
  border:1px solid rgba(201,168,76,0.1);
  border-radius:4px;
}

.score-side { text-align:center; }
.score-label { font-family:'Cinzel', serif; font-size:0.5rem; letter-spacing:0.25em; opacity:0.5; margin-bottom:2px; }
.score-name { font-family:'Cinzel', serif; font-size:0.65rem; letter-spacing:0.15em; margin-bottom:4px; }
.score-pieces { font-family:'Cinzel', serif; font-size:1.4rem; font-weight:700; }
.score-you .score-pieces { color:var(--white-piece); text-shadow:0 0 15px rgba(240,230,204,0.5); }
.score-bot .score-pieces { color:#aaa; text-shadow:0 0 10px rgba(255,255,255,0.2); }
.vs-label { font-family:'Cinzel', serif; font-size:0.7rem; color:rgba(201,168,76,0.3); }

/* TABLERO */
.board-wrap {
  position:relative;
  width:min(90vw, 400px);
  aspect-ratio:1;
}

.board-frame {
  position:absolute; inset:-10px;
  background:linear-gradient(135deg, #555, #222, #555, #222);
  border-radius:4px;
  box-shadow: 0 0 0 2px var(--gold3), 0 0 40px rgba(0,0,0,0.8), inset 0 0 20px rgba(0,0,0,0.5);
}

.board-frame::before {
  content:'';
  position:absolute; inset:4px;
  border:1px solid rgba(201,168,76,0.2);
  border-radius:2px;
  pointer-events:none;
}

.board {
  position:relative; z-index:2;
  width:100%; height:100%;
  display:grid;
  grid-template-columns:repeat(8,1fr);
  grid-template-rows:repeat(8,1fr);
  border:2px solid var(--gold3);
}

.sq {
  position:relative;
  display:flex; align-items:center; justify-content:center;
  cursor:default;
  transition:background 0.15s;
}

.sq.light { background: var(--light-sq); }
.sq.dark  { background: var(--dark-sq); }
.sq.dark.playable { cursor:pointer; }
.sq.dark.playable:hover { background:#333; }
.sq.selected { background:#5a4020 !important; box-shadow:inset 0 0 0 3px var(--gold); }
.sq.valid-move { background:#1a3a1a !important; cursor:pointer; }
.sq.valid-move::after {
  content:'';
  width:30%; height:30%;
  background:rgba(46,204,113,0.6);
  border-radius:50%;
  box-shadow:0 0 12px rgba(46,204,113,0.8);
}
.sq.last-move { background:#3a3010 !important; }

/* PIEZAS */
.piece {
  width:76%; height:76%;
  border-radius:50%;
  position:relative;
  transition:transform 0.15s;
  cursor:pointer;
}

.piece.white {
  background:radial-gradient(circle at 35% 35%, var(--white-piece2), var(--white-piece), #c8b89a);
  box-shadow:0 3px 8px rgba(0,0,0,0.6), inset 0 -2px 4px rgba(0,0,0,0.2), inset 0 2px 4px rgba(255,255,255,0.3);
  border:2px solid rgba(200,184,154,0.5);
}

.piece.red {
  background:radial-gradient(circle at 35% 35%, #555, #222, #000);
  box-shadow:0 3px 8px rgba(0,0,0,0.8), inset 0 -2px 4px rgba(0,0,0,0.5), inset 0 2px 4px rgba(255,255,255,0.08);
  border:2px solid rgba(80,80,80,0.5);
}

.piece.white:hover, .piece.red:hover { transform:scale(1.08); }
.piece.white.selected, .piece.red.selected { transform:scale(1.12); }

.piece.king::after {
  content:'‚ôõ';
  position:absolute;
  top:50%; left:50%;
  transform:translate(-50%,-50%);
  font-size:45%;
  line-height:1;
  filter:drop-shadow(0 1px 2px rgba(0,0,0,0.5));
}
.piece.white.king::after { color:rgba(100,80,40,0.8); }
.piece.red.king::after { color:rgba(255,220,150,0.9); }

/* STATUS */
.status-bar {
  width:100%; max-width:400px;
  margin-top:14px;
  padding:10px 18px;
  text-align:center;
  font-family:'Cinzel', serif;
  font-size:0.7rem;
  letter-spacing:0.2em;
  border:1px solid rgba(201,168,76,0.15);
  border-radius:4px;
  background:rgba(0,0,0,0.3);
  min-height:40px;
  display:flex; align-items:center; justify-content:center;
}

.thinking { color:rgba(201,168,76,0.6); font-style:italic; }
.your-turn { color:var(--white-piece); }
.bot-turn  { color:var(--red-piece2); }

.thinking-dots span {
  animation: tdot 1s infinite;
  display:inline-block;
}
.thinking-dots span:nth-child(2){ animation-delay:.2s; }
.thinking-dots span:nth-child(3){ animation-delay:.4s; }
@keyframes tdot { 0%,60%,100%{opacity:0.2;} 30%{opacity:1;} }

/* MODAL RESULTADO */
.modal-overlay {
  position:fixed; inset:0;
  background:rgba(0,0,0,0.88);
  backdrop-filter:blur(8px);
  display:flex; align-items:center; justify-content:center;
  z-index:100; opacity:0; pointer-events:none; transition:opacity 0.4s;
}
.modal-overlay.show { opacity:1; pointer-events:all; }
.modal-box {
  background:linear-gradient(135deg,#1a1408,#0d0a06);
  border:1px solid var(--gold3);
  border-radius:6px;
  padding:40px 32px;
  text-align:center;
  max-width:300px; width:90%;
  box-shadow:0 0 60px rgba(0,0,0,0.8), 0 0 30px rgba(201,168,76,0.1);
  transform:scale(0.85);
  transition:transform 0.4s cubic-bezier(0.34,1.56,0.64,1);
}
.modal-overlay.show .modal-box { transform:scale(1); }
.modal-emoji { font-size:3.5rem; margin-bottom:12px; }
.modal-title {
  font-family:'Cinzel', serif; font-weight:900;
  font-size:clamp(1.4rem,6vw,2rem);
  letter-spacing:0.15em; margin-bottom:8px;
}
.modal-title.win { color:var(--gold2); text-shadow:var(--glow-gold); }
.modal-title.lose { color:var(--red-piece2); }
.modal-title.draw { color:rgba(201,168,76,0.7); }
.modal-sub { font-size:0.85rem; color:rgba(255,255,255,0.4); font-style:italic; margin-bottom:24px; }
.modal-btns { display:flex; gap:10px; justify-content:center; flex-wrap:wrap; }
.modal-btn {
  padding:11px 20px; border-radius:4px;
  font-family:'Cinzel', serif; font-size:0.6rem; letter-spacing:0.2em;
  cursor:pointer; transition:all 0.2s; border:1px solid;
}
.modal-btn.primary {
  border-color:var(--gold); background:rgba(201,168,76,0.1); color:var(--gold2);
}
.modal-btn.primary:hover { background:rgba(201,168,76,0.2); box-shadow:var(--glow-gold); }
.modal-btn.secondary {
  border-color:rgba(255,255,255,0.15); background:transparent; color:rgba(255,255,255,0.4);
}
.modal-btn.secondary:hover { border-color:rgba(255,255,255,0.4); color:rgba(255,255,255,0.7); }
</style>
</head>
<body>

<!-- MEN√ö -->
<div id="screen-menu">
  <div class="logo-wrap">
    <span class="logo-crown">‚ôõ</span>
    <div class="logo-title">DAMAS</div>
    <div class="logo-sub">EDICI√ìN CL√ÅSICA</div>
    <div class="divider"></div>
  </div>

  <div class="menu-label">ELIGE LA DIFICULTAD</div>

  <div class="difficulty-cards">
    <button class="diff-card diff-easy" onclick="iniciarJuego('easy')">
      <span class="diff-icon">üåø</span>
      <div class="diff-name">F√ÅCIL</div>
      <div class="diff-desc">El bot comete errores ‚Äî ideal para aprender</div>
    </button>
    <button class="diff-card diff-normal" onclick="iniciarJuego('normal')">
      <span class="diff-icon">‚öîÔ∏è</span>
      <div class="diff-name">NORMAL</div>
      <div class="diff-desc">Partida equilibrada ‚Äî un buen reto</div>
    </button>
    <button class="diff-card diff-hard" onclick="iniciarJuego('hard')">
      <span class="diff-icon">üíÄ</span>
      <div class="diff-name">DIF√çCIL</div>
      <div class="diff-desc">IA avanzada ‚Äî solo para expertos</div>
    </div>
  </div>

  </button>

  <div class="creator-badge">‚ö° BY THE CRIS IF ‚ö°</div>
</div>

<!-- JUEGO -->
<div id="screen-game">
  <div class="game-header">
    <button class="btn-back-game" onclick="volverMenu()">‚óÄ MEN√ö</button>
    <div class="diff-badge" id="diff-badge">NORMAL</div>
  </div>

  <div class="score-bar">
    <div class="score-side score-you">
      <div class="score-label">T√ö</div>
      <div class="score-name">BLANCAS</div>
      <div class="score-pieces" id="score-you">12</div>
    </div>
    <div class="vs-label">VS</div>
    <div class="score-side score-bot">
      <div class="score-label">BOT</div>
      <div class="score-name">ROJAS</div>
      <div class="score-pieces" id="score-bot">12</div>
    </div>
  </div>

  <div class="board-wrap">
    <div class="board-frame"></div>
    <div class="board" id="board"></div>
  </div>

  <div class="status-bar" id="status">Tu turno ‚Äî elige una pieza blanca</div>
</div>

<!-- MODAL -->
<div class="modal-overlay" id="modal">
  <div class="modal-box">
    <div class="modal-emoji" id="modal-emoji">üèÜ</div>
    <div class="modal-title" id="modal-title">¬°GANASTE!</div>
    <div class="modal-sub" id="modal-sub">Excelente partida</div>
    <div class="modal-btns">
      <button class="modal-btn primary" onclick="reiniciarPartida()">REVANCHA</button>
      <button class="modal-btn secondary" onclick="volverMenu()">MEN√ö</button>
    </div>
  </div>
</div>

<script>
// ============================================================
// DAMAS ‚Äî MOTOR COMPLETO
// ============================================================

var dificultad = 'normal';
var turno = 'white'; // white = jugador, red = bot
var tablero = [];
var seleccionada = null;
var movimientosValidos = [];
var ultimoMovimiento = [];
var botPensando = false;
var debeCapturar = null; // pieza que debe seguir capturando (multisalto)

// Profundidad de b√∫squeda seg√∫n dificultad
var DEPTH = { easy:1, normal:3, hard:5 };

// ============================================================
// INICIALIZAR TABLERO
// ============================================================
function crearTablero() {
  tablero = [];
  for(var r=0;r<8;r++){
    tablero[r] = [];
    for(var c=0;c<8;c++){
      tablero[r][c] = null;
      if((r+c)%2===1){
        if(r<3) tablero[r][c] = {color:'red', king:false};
        else if(r>4) tablero[r][c] = {color:'white', king:false};
      }
    }
  }
}

// ============================================================
// RENDER
// ============================================================
function render() {
  var board = document.getElementById('board');
  board.innerHTML = '';

  for(var r=0;r<8;r++){
    for(var c=0;c<8;c++){
      var sq = document.createElement('div');
      sq.className = 'sq ' + ((r+c)%2===0 ? 'light' : 'dark');
      sq.dataset.r = r; sq.dataset.c = c;

      var isDark = (r+c)%2===1;

      // Marcar √∫ltimo movimiento
      if(ultimoMovimiento.some(function(m){ return m[0]===r && m[1]===c; })){
        sq.classList.add('last-move');
      }

      // Marcar seleccionada
      if(seleccionada && seleccionada[0]===r && seleccionada[1]===c){
        sq.classList.add('selected');
      }

      // Marcar movimientos v√°lidos
      if(movimientosValidos.some(function(m){ return m.to[0]===r && m.to[1]===c; })){
        sq.classList.add('valid-move');
        (function(rr,cc){
          sq.addEventListener('click', function(){ moverA(rr,cc); });
        })(r,c);
      }

      // Pieza
      if(tablero[r][c]){
        var pieza = document.createElement('div');
        pieza.className = 'piece ' + tablero[r][c].color + (tablero[r][c].king?' king':'');
        if(seleccionada && seleccionada[0]===r && seleccionada[1]===c){
          pieza.classList.add('selected');
        }
        if(turno==='white' && tablero[r][c].color==='white' && !botPensando){
          (function(rr,cc){
            pieza.addEventListener('click', function(e){
              e.stopPropagation();
              seleccionarPieza(rr,cc);
            });
          })(r,c);
        }
        sq.appendChild(pieza);
      }

      board.appendChild(sq);
    }
  }

  // Actualizar contadores
  var wCount=0, rCount=0;
  for(var i=0;i<8;i++) for(var j=0;j<8;j++){
    if(tablero[i][j]){
      if(tablero[i][j].color==='white') wCount++;
      else rCount++;
    }
  }
  document.getElementById('score-you').textContent = wCount;
  document.getElementById('score-bot').textContent = rCount;
}

// ============================================================
// SELECCIONAR PIEZA
// ============================================================
function seleccionarPieza(r, c) {
  if(botPensando || turno!=='white') return;
  if(!tablero[r][c] || tablero[r][c].color!=='white') return;

  // Si hay obligaci√≥n de capturar con pieza espec√≠fica
  if(debeCapturar && !(debeCapturar[0]===r && debeCapturar[1]===c)) return;

  // Calcular movimientos forzados (capturas obligatorias)
  var todasCapturas = obtenerTodasCapturas('white');

  var movs;
  if(todasCapturas.length > 0){
    movs = todasCapturas.filter(function(m){ return m.from[0]===r && m.from[1]===c; });
    if(movs.length===0){ setStatus('¬°Debes capturar una pieza roja!','you'); return; }
  } else {
    movs = obtenerMovimientos(r, c, tablero);
  }

  if(movs.length===0) return;

  seleccionada = [r,c];
  movimientosValidos = movs;
  render();
}

// ============================================================
// MOVER
// ============================================================
function moverA(r, c) {
  var mov = movimientosValidos.find(function(m){ return m.to[0]===r && m.to[1]===c; });
  if(!mov) return;

  ejecutarMovimiento(mov, tablero);

  // Coronar reina
  if(r===0 && tablero[r][c] && tablero[r][c].color==='white') tablero[r][c].king=true;

  ultimoMovimiento = [[mov.from[0],mov.from[1]],[r,c]];

  // Multisalto
  if(mov.captures && mov.captures.length>0){
    var masCapturas = obtenerMovimientosCaptura(r, c, tablero);
    if(masCapturas.length>0){
      seleccionada = [r,c];
      movimientosValidos = masCapturas;
      debeCapturar = [r,c];
      render();
      setStatus('¬°Captura doble! Sigue moviendo','you');
      return;
    }
  }

  seleccionada = null;
  movimientosValidos = [];
  debeCapturar = null;

  if(verificarFin()) return;

  turno = 'red';
  render();
  setStatus('Bot pensando<span class="thinking-dots"><span>.</span><span>.</span><span>.</span></span>','bot');

  var delay = dificultad==='easy' ? 600 : dificultad==='normal' ? 900 : (1600 + Math.floor(Math.random()*1200));
  setTimeout(function(){ moverBot(); }, delay);
}

// ============================================================
// EJECUTAR MOVIMIENTO EN TABLERO
// ============================================================
function ejecutarMovimiento(mov, tab) {
  var pieza = tab[mov.from[0]][mov.from[1]];
  tab[mov.to[0]][mov.to[1]] = pieza;
  tab[mov.from[0]][mov.from[1]] = null;

  if(mov.captures){
    for(var i=0;i<mov.captures.length;i++){
      tab[mov.captures[i][0]][mov.captures[i][1]] = null;
    }
  }

  // Coronar: blancas llegan a fila 0, rojas llegan a fila 7
  if(mov.to[0]===0 && pieza && pieza.color==='white') pieza.king=true;
  if(mov.to[0]===7 && pieza && pieza.color==='red') pieza.king=true;
}

function deshacerMovimiento(mov, pieza, capturadas, tab) {
  tab[mov.from[0]][mov.from[1]] = pieza;
  tab[mov.to[0]][mov.to[1]] = null;
  for(var i=0;i<capturadas.length;i++){
    tab[capturadas[i].pos[0]][capturadas[i].pos[1]] = capturadas[i].pieza;
  }
}

// ============================================================
// OBTENER MOVIMIENTOS SIMPLES
// ============================================================
function obtenerMovimientos(r, c, tab) {
  var pieza = tab[r][c];
  if(!pieza) return [];

  var capturas = obtenerMovimientosCaptura(r, c, tab);
  if(capturas.length>0) return capturas;

  var movs = [];
  var dirs = [];
  if(pieza.color==='white' || pieza.king) dirs.push([-1,-1],[-1,1]);
  if(pieza.color==='red'   || pieza.king) dirs.push([1,-1],[1,1]);

  if(pieza.king){
    for(var i=0;i<dirs.length;i++){
      for(var step=1;step<8;step++){
        var nr = r+dirs[i][0]*step, nc = c+dirs[i][1]*step;
        if(nr<0||nr>=8||nc<0||nc>=8) break;
        if(tab[nr][nc]) break;
        movs.push({from:[r,c], to:[nr,nc], captures:[]});
      }
    }
  } else {
    for(var i=0;i<dirs.length;i++){
      var nr = r+dirs[i][0], nc = c+dirs[i][1];
      if(nr>=0&&nr<8&&nc>=0&&nc<8&&!tab[nr][nc]){
        movs.push({from:[r,c], to:[nr,nc], captures:[]});
      }
    }
  }
  return movs;
}

function obtenerMovimientosCaptura(r, c, tab) {
  var pieza = tab[r][c];
  if(!pieza) return [];

  var capturas = [];
  var enemigoColor = pieza.color==='white'?'red':'white';

  if(pieza.king){
    var dirs = [[-1,-1],[-1,1],[1,-1],[1,1]];
    for(var i=0;i<dirs.length;i++){
      var enemigoEncontrado = null;
      for(var step=1;step<8;step++){
        var nr = r+dirs[i][0]*step, nc = c+dirs[i][1]*step;
        if(nr<0||nr>=8||nc<0||nc>=8) break;
        if(tab[nr][nc]){
          if(tab[nr][nc].color===enemigoColor && !enemigoEncontrado){
            enemigoEncontrado = [nr,nc];
          } else { break; }
        } else if(enemigoEncontrado){
          capturas.push({from:[r,c], to:[nr,nc], captures:[enemigoEncontrado]});
        }
      }
    }
  } else {
    var dirsNormal = [];
    if(pieza.color==='white') dirsNormal = [[-1,-1],[-1,1]];
    else dirsNormal = [[1,-1],[1,1]];
    for(var i=0;i<dirsNormal.length;i++){
      var mr = r+dirsNormal[i][0], mc = c+dirsNormal[i][1];
      var lr = r+dirsNormal[i][0]*2, lc = c+dirsNormal[i][1]*2;
      if(mr>=0&&mr<8&&mc>=0&&mc<8&&lr>=0&&lr<8&&lc>=0&&lc<8){
        if(tab[mr][mc]&&tab[mr][mc].color===enemigoColor&&!tab[lr][lc]){
          capturas.push({from:[r,c], to:[lr,lc], captures:[[mr,mc]]});
        }
      }
    }
  }
  return capturas;
}

// ============================================================
// OBTENER TODAS LAS CAPTURAS DE UN COLOR
// ============================================================
function obtenerTodasCapturas(color) {
  var todas = [];
  for(var r=0;r<8;r++) for(var c=0;c<8;c++){
    if(tablero[r][c]&&tablero[r][c].color===color){
      var caps = obtenerMovimientosCaptura(r,c,tablero);
      for(var i=0;i<caps.length;i++) todas.push(caps[i]);
    }
  }
  return todas;
}

function obtenerTodosMovimientos(color, tab) {
  var todos = [];
  // Primero buscar capturas
  var capturas = [];
  for(var r=0;r<8;r++) for(var c=0;c<8;c++){
    if(tab[r][c]&&tab[r][c].color===color){
      var caps = obtenerMovimientosCaptura(r,c,tab);
      for(var i=0;i<caps.length;i++) capturas.push(caps[i]);
    }
  }
  if(capturas.length>0) return capturas;

  // Si no hay capturas, movimientos normales
  for(var r=0;r<8;r++) for(var c=0;c<8;c++){
    if(tab[r][c]&&tab[r][c].color===color){
      var movs = obtenerMovimientos(r,c,tab).filter(function(m){ return m.captures.length===0; });
      for(var i=0;i<movs.length;i++) todos.push(movs[i]);
    }
  }
  return todos;
}

// ============================================================
// BOT IA ‚Äî MINIMAX CON ALPHA-BETA
// ============================================================
function moverBot() {
  botPensando = true;
  var movs = obtenerTodosMovimientos('red', tablero);

  if(movs.length===0){
    mostrarModal('üèÜ','¬°GANASTE!','El bot no tiene movimientos','win');
    botPensando=false; return;
  }

  var mejorMov = null;

  if(dificultad==='easy'){
    // F√°cil: movimiento aleatorio con preferencia por capturas
    var capturas = movs.filter(function(m){ return m.captures.length>0; });
    var pool = capturas.length>0 ? capturas : movs;
    // 30% de chance de error (ignorar captura)
    if(capturas.length>0 && Math.random()<0.3) pool=movs;
    mejorMov = pool[Math.floor(Math.random()*pool.length)];
  } else {
    // Normal/Dif√≠cil: minimax
    var profundidad = DEPTH[dificultad];
    var mejorVal = -Infinity;
    for(var i=0;i<movs.length;i++){
      var copia = copiarTablero(tablero);
      var piezaGuardada = {color:copia[movs[i].from[0]][movs[i].from[1]].color, king:copia[movs[i].from[0]][movs[i].from[1]].king};
      var capGuardadas = guardarCapturadas(movs[i], copia);
      ejecutarMovimiento(movs[i], copia);
      var val = minimax(copia, profundidad-1, -Infinity, Infinity, false);
      if(val > mejorVal){ mejorVal=val; mejorMov=movs[i]; }
    }
  }

  if(!mejorMov){ botPensando=false; return; }

  // Aplicar movimiento del bot
  ejecutarMovimiento(mejorMov, tablero);
  ultimoMovimiento = [[mejorMov.from[0],mejorMov.from[1]],[mejorMov.to[0],mejorMov.to[1]]];

  // Coronar rey rojo (llega a fila 7 = lado del jugador)
  if(mejorMov.to[0]===7 && tablero[mejorMov.to[0]][mejorMov.to[1]] && tablero[mejorMov.to[0]][mejorMov.to[1]].color==='red') tablero[mejorMov.to[0]][mejorMov.to[1]].king=true;

  botPensando = false;

  if(verificarFin()) return;

  turno = 'white';
  render();
  setStatus('Tu turno ‚Äî elige una pieza blanca','you');
}

// ============================================================
// MINIMAX CON ALPHA-BETA
// ============================================================
function minimax(tab, depth, alpha, beta, maximizando) {
  if(depth===0) return evaluar(tab);

  var color = maximizando ? 'red' : 'white';
  var movs = obtenerTodosMovimientos(color, tab);

  if(movs.length===0) return maximizando ? -1000 : 1000;

  if(maximizando){
    var maxVal = -Infinity;
    for(var i=0;i<movs.length;i++){
      var copia = copiarTablero(tab);
      ejecutarMovimiento(movs[i], copia);
      var val = minimax(copia, depth-1, alpha, beta, false);
      if(val>maxVal) maxVal=val;
      if(val>alpha) alpha=val;
      if(beta<=alpha) break;
    }
    return maxVal;
  } else {
    var minVal = Infinity;
    for(var i=0;i<movs.length;i++){
      var copia = copiarTablero(tab);
      ejecutarMovimiento(movs[i], copia);
      var val = minimax(copia, depth-1, alpha, beta, true);
      if(val<minVal) minVal=val;
      if(val<beta) beta=val;
      if(beta<=alpha) break;
    }
    return minVal;
  }
}

// ============================================================
// FUNCI√ìN DE EVALUACI√ìN
// ============================================================
function evaluar(tab) {
  var score = 0;
  for(var r=0;r<8;r++) for(var c=0;c<8;c++){
    var p = tab[r][c];
    if(!p) continue;
    var val = p.king ? 3 : 1;

    // Bonus por posici√≥n
    if(!p.king){
      if(p.color==='red') val += (r/7)*0.5;    // avanzar hacia abajo
      else val += ((7-r)/7)*0.5;                // avanzar hacia arriba
    }

    // Bonus por control del centro
    if(c>=2&&c<=5&&r>=2&&r<=5) val += 0.2;

    // Bonus por seguridad en bordes laterales
    if(c===0||c===7) val += 0.15;

    if(p.color==='red') score+=val;
    else score-=val;
  }
  return score;
}

// ============================================================
// UTILIDADES
// ============================================================
function copiarTablero(tab) {
  var copia = [];
  for(var r=0;r<8;r++){
    copia[r]=[];
    for(var c=0;c<8;c++){
      copia[r][c] = tab[r][c] ? {color:tab[r][c].color, king:tab[r][c].king} : null;
    }
  }
  return copia;
}

function guardarCapturadas(mov, tab) {
  var guardadas = [];
  if(mov.captures){
    for(var i=0;i<mov.captures.length;i++){
      var pos = mov.captures[i];
      if(tab[pos[0]][pos[1]]) guardadas.push({pos:pos, pieza:tab[pos[0]][pos[1]]});
    }
  }
  return guardadas;
}

// ============================================================
// VERIFICAR FIN
// ============================================================
function verificarFin() {
  var whites=0, reds=0;
  for(var r=0;r<8;r++) for(var c=0;c<8;c++){
    if(tablero[r][c]){
      if(tablero[r][c].color==='white') whites++;
      else reds++;
    }
  }

  if(whites===0){ render(); mostrarModal('üíÄ','PERDISTE','El bot fue mejor esta vez','lose'); return true; }
  if(reds===0)  { render(); mostrarModal('üèÜ','¬°GANASTE!','Eliminaste todas las rojas','win'); return true; }

  // Verificar si alguno no puede mover
  if(turno==='white' && obtenerTodosMovimientos('white',tablero).length===0){
    render(); mostrarModal('üíÄ','PERDISTE','No tienes movimientos posibles','lose'); return true;
  }
  if(turno==='red' && obtenerTodosMovimientos('red',tablero).length===0){
    render(); mostrarModal('üèÜ','¬°GANASTE!','El bot no tiene movimientos','win'); return true;
  }
  return false;
}

// ============================================================
// UI
// ============================================================
function setStatus(html, tipo) {
  var el = document.getElementById('status');
  el.innerHTML = html;
  el.className = 'status-bar ' + (tipo==='you'?'your-turn':tipo==='bot'?'bot-turn thinking':'');
}

function mostrarModal(emoji, titulo, sub, tipo) {
  document.getElementById('modal-emoji').textContent = emoji;
  var t = document.getElementById('modal-title');
  t.textContent = titulo;
  t.className = 'modal-title '+tipo;
  document.getElementById('modal-sub').textContent = sub;
  document.getElementById('modal').classList.add('show');
}

function cerrarModal() {
  document.getElementById('modal').classList.remove('show');
}

function iniciarJuego(diff) {
  dificultad = diff;
  var badge = document.getElementById('diff-badge');
  badge.textContent = diff==='easy'?'F√ÅCIL':diff==='normal'?'NORMAL':'DIF√çCIL';
  badge.className = 'diff-badge badge-'+diff;

  document.getElementById('screen-menu').style.display = 'none';
  document.getElementById('screen-game').style.display = 'flex';

  crearTablero();
  turno = 'white';
  seleccionada = null;
  movimientosValidos = [];
  ultimoMovimiento = [];
  debeCapturar = null;
  botPensando = false;
  cerrarModal();
  render();
  setStatus('Tu turno ‚Äî elige una pieza blanca','you');
}

function reiniciarPartida() {
  cerrarModal();
  iniciarJuego(dificultad);
}

function volverMenu() {
  cerrarModal();
  document.getElementById('screen-game').style.display = 'none';
  document.getElementById('screen-menu').style.display = 'flex';
  botPensando = false;
}
</script>
</body>
</html>